/******************************************************************************
** _TX_: 0xf6022012b73770e7e2177129e648980a82aab555f9ac88b8a9cda3ec44b30779
** _BLOCK_: 11792260
** _DETAILS_: An exploit against Yearn’s v1 yDAI vault has led to 11m DAI of
**		vault deposits being lost. Acting in roughly 11 minutes, Yearn’s
**		security team and multi-sig wallet signers were able to stop the
**		exploit while it was underway, saving 24m DAI out of the vault’s
**		total 35m DAI deposits. By creating exchange rate imbalances in
**		Curve’s 3pool, an exploiter was able to cause Yearn’s yDAI vault to
**		deposit and withdraw funds from 3pool at unfavorable rates across a
**		series of transactions.
******************************************************************************/
const	YEARN_DAI_ADDRESS = '0xacd43e627e64355f1861cec6d3a6688b31a6f952';
const	YEARN_DAI_HACK_BLOCK = '11792260';
const	YEARN_DAI_JSON = [{"constant": true,"inputs": [{"internalType": "address","name": "account","type": "address"}],"name": "balanceOf","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"}];

async function	checkYearnDaiExploit(web3, userAddress) {
	const	yearnDaiJSON = new window.web3.eth.Contract(YEARN_DAI_JSON, YEARN_DAI_ADDRESS);
	const	balanceOnHackTime = await yearnDaiJSON.methods.balanceOf(userAddress).call(undefined, YEARN_DAI_HACK_BLOCK).then(e => e);
	if (Number(balanceOnHackTime) > 0) {
		return {unlocked: true, informations: {
			blockNumber: YEARN_DAI_HACK_BLOCK,
			hash: '0xf6022012b73770e7e2177129e648980a82aab555f9ac88b8a9cda3ec44b30779',
			details: balanceOnHackTime,
			timestamp: 1612431092000,
		}};
	}
	return {unlocked: false, informations: undefined};
}

export default checkYearnDaiExploit;